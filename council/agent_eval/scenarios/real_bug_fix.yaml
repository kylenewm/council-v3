scenario:
  id: "real-bug-001"
  name: "Fix Off-by-One Bug in Pagination"
  description: "Agent must find and fix a subtle off-by-one error in pagination logic"

  setup:
    files:
      - path: "paginator.py"
        content: |
          """Pagination utility for API results."""

          def paginate(items: list, page: int, per_page: int = 10) -> dict:
              """Return a page of items with metadata.

              Args:
                  items: Full list of items
                  page: Page number (1-indexed)
                  per_page: Items per page

              Returns:
                  Dict with 'items', 'page', 'total_pages', 'has_next', 'has_prev'
              """
              total = len(items)
              total_pages = (total + per_page - 1) // per_page  # Ceiling division

              # BUG: Off-by-one error - page 1 should start at index 0
              start = page * per_page  # Wrong: should be (page - 1) * per_page
              end = start + per_page

              page_items = items[start:end]

              return {
                  'items': page_items,
                  'page': page,
                  'total_pages': total_pages,
                  'has_next': page < total_pages,
                  'has_prev': page > 1,
              }
      - path: "test_paginator.py"
        content: |
          """Tests for paginator - these currently fail due to bug."""
          import pytest
          from paginator import paginate

          def test_first_page():
              items = list(range(25))  # 0-24
              result = paginate(items, page=1, per_page=10)

              assert result['items'] == [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
              assert result['page'] == 1
              assert result['total_pages'] == 3
              assert result['has_next'] == True
              assert result['has_prev'] == False

          def test_second_page():
              items = list(range(25))
              result = paginate(items, page=2, per_page=10)

              assert result['items'] == [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
              assert result['has_next'] == True
              assert result['has_prev'] == True

          def test_last_page():
              items = list(range(25))
              result = paginate(items, page=3, per_page=10)

              assert result['items'] == [20, 21, 22, 23, 24]
              assert result['has_next'] == False
              assert result['has_prev'] == True

          def test_empty_items():
              result = paginate([], page=1)
              assert result['items'] == []
              assert result['total_pages'] == 0

          def test_single_page():
              items = [1, 2, 3]
              result = paginate(items, page=1, per_page=10)

              assert result['items'] == [1, 2, 3]
              assert result['total_pages'] == 1
              assert result['has_next'] == False
              assert result['has_prev'] == False

  prompt: "The tests in test_paginator.py are failing. Find and fix the bug in paginator.py."

  verification:
    commands:
      - cmd: "python3 -m pytest test_paginator.py -v"
        expect_exit_code: 0
    files:
      - path: "paginator.py"
        exists: true
        contains: "(page - 1)"

  difficulty: easy
  tags:
    - python
    - bug-fix
    - off-by-one
    - real-world

  expected_behavior: |
    Agent should:
    1. Run the tests to see failures
    2. Identify the off-by-one error in line: start = page * per_page
    3. Fix to: start = (page - 1) * per_page
    4. Verify tests pass

  watchdog_questions:
    - "Did the agent run the tests first to understand the failure?"
    - "Did the agent identify the root cause correctly?"
    - "Was the fix minimal or did it over-engineer?"
